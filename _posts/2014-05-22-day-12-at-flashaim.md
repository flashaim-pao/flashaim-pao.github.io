---
layout: post
title: 'Day 12 at Flashaim'
date: 2014-05-22 01:56
image: ''
description: ''
categories:
    - 工作紀實
tags:
    - 新人日誌
    - 知識科技
 
---
# Mashup 負載測試
[測試結果](https://docs.google.com/a/flashaim.com/spreadsheets/d/1l0P3gf98sS54jGH0OuKdNMKelTf6vYzI8tMfOXsh07I/edit?usp=sharing)
我們可以從平均 Throughput （每秒處理請求數）的結果看出，Mashup 能承受的同時使用者操作人數約為 **280**。附帶一題，這數據並非上線人數，上線人數看的是存活中的 Session 數（但可能已離開），會高於同時操作人數。

可以觀察幾個現象來推論瓶頸：
1. 可以看到處裡器使用率在測試時最高僅 20%
	+ 離 100% 還很遠
1. 流量尖峰不超過 1,000 KBps
  + 離網友實測 HiCloud 的 11 MBps 還很遠
1. 磁碟寫入高峰僅 300 多KBps
  + 這是指傳輸速度非反應速度

因此瓶頸很可能出現在磁碟反應速度上，磁碟機搜尋時間是很高的。因此要提高承載量的話：
1. 用更快的磁碟機
  + 但 HiCloud 沒有其他選擇（附帶一題，Linode 的磁碟機都是固態硬碟 SSD）
2. 最佳化資料庫
  + 例如建立索引、改善 SQL 等
3. 使用快取
  + 例如使用 Memcached 快取一些資料
4. 建立資料庫或檔案系統叢集

# 版本控制系統
阿信延續昨天的提案，希望由 Subversion（SVN）轉移至 GIT 。因此請我幫忙大夥解答安裝方面的問題，同時也幫忙建立 Bitbucket Repostory（儲存庫） 給 Mashup 專案使用。為了要保留原 Subversion 內的版本紀錄，因此狀況較為特殊，所以我也協助將 Subversion 的儲存庫轉換至 GIT 儲存庫。使用了 `git-svn` 工具進行轉換，並且分別對五個儲存庫建立遠端設定以及第一次的上傳動作。
然而在了解問題發生的背後緣由後，我發現癥結點是在**團隊共同開發的「流程」**。對此我提出兩個版本的建議，分別是使用共用測試主機的模式以及本地測試的模式。但我僅只止於提供協助，這方面要由阿信和團隊作協商。決定出共識後，才由我於下次 RD 會議時，直接示範開發流程給大夥參考。

# Mashup 備份策略
目前 Mashup 的 web 資料夾裡共約 33 GB 的檔案，增長率不明。目前針對幾個策略進行分析：

1. 一台普通的 NAS (4Bay) 裝滿 4 顆 2TB 硬碟約 26,600 元
  + http://24h.pchome.com.tw/prod/DRAF2U-190052PL2
  + 組 RAID 5 後可用空間為 6TB
  + 假設以差異式備份且每日增加 1 GB 則每日流量費為 3元
1. 以 26,600 元為基準，找一台公司舊電腦插新硬碟，可以買 4 顆新的 4TB 的 NAS 專用硬碟
  + http://24h.pchome.com.tw/prod/DRAB37-A84290092?q=/S/DRAB37
  + 組 RAID 5 後可用空間為 12TB
  + 假設以差異式備份且每日增加 1 GB 則每日流量費為 3元
1. 以同樣價錢為基礎使用 HiCloud S3 服務作為儲存
  + 1 GB/月為 2 元，所以有 13,300 GB/月
  + 以 33GB 開始，每日增加 1G 則約可使用 271 天
  + 若使用 300GB 折合每日約 20 元
1. 使用 HiCloud 的免費自動 Snapshot
  + 週期較長每週僅 3 次
  + 說明書並未詳述外加之硬碟有無此免費服務

備份建立與設定則會因為方案選擇的不同而有所差異，這部份要等確認後才開始。然而備份策略如完全備份、差異式備份、備份數量等等，還是會影響最後的成本。

# 網站無法檢視問題
客戶遇到了某些人看得到網站而有些人看不到同一個網站的問題。仁哥問我時，我一時三刻也無法得知原因。因此透過 `nslookup` 去觀察 DNS 紀錄，發現對應至兩個 IP。若將網址套用其中一個 IP ，就能重現仁哥傳給我的截圖。那問題應該就是出自於 DNS 設定上，DNS 若採用 Round-Robin 則會有一半的人看得到，另一半的人看不到的狀況發生。

# Trace 開發專案
目前開始調查並建置專案所需的工具如 *Trello、BitBucket 、Issue Tracker* 等，同時正在建立開發環境如 *Yeoman* 與 *Vagrant* 等。其他的開發環境則等到更明朗時，再陸續建置。