---
layout: post
title: '工作紀實 2016年 5月'
date: 2016-05-30 16:00
image: ''
description: ''
categories:
    - 工作紀實
tags:
    - 月報
    - 知識科技
 
---
# S1 主機轉移計畫

上個月交接給信宇之後，工作進行的順利，已經完成許多網站的轉出與建檔（送入軟體版本管理系統）。當然如**預期**的一樣，遇到了原先不曉得的狀況：cPanel 建立的資料庫名稱最多僅 8 個字元。所以我與信宇一起調整自動化建置腳本，使其可以對應這樣的狀況。而再經過數個網站轉出後，也是如**預期**一般，再度遇到狀況。然而這是因為此網站的結構非常特殊，多個幾乎一樣的網站被塞進同一個站台內，每個網站各用一個資料庫。由於針對特殊狀況去改寫建置腳本不符合效益，因此採取個案處理，使用獨立的同步建置腳本。

* 完成的項目
    + 協助調整同步腳本以符合 ID 截短問題

# FlashBot 試作

上個月底試作的 Skype Bot 因為微軟政策過渡期的緣故，這個月花了一點點時間製作了 Line Bot。不過這也是剛好 Line 在上個月公開了 Line Bot API，我想大概是受到了 Facebook Messenger 開放 Bot API 的影響... 但或許是剛開放的關係，Line Bot API 並沒有 SDK（Software Development Kit），因此都要徒手撰寫。所幸不是太難搞的 API，目前 FlashBot 已經可以 echo 傳給它的訊息。然而，我所使用的 Line 帳號無法讓 Bot 收取群組訊息，因此請公司提供了一組 Line@ 帳號。很可惜的是，Line@ 依然不夠權限收到群組訊息。最後只好請仁哥協助申請 Line 商業夥伴帳號，目前 FlashBot 就先擱置，等待帳號通過才能繼續了。

## 完成的項目

* 改以 Line Bot API 製作 FlashBot
    + 接收訊息並 echo 回去
    
## 執行中的項目

* 加入群組對話
    + 等待 Line 商用帳號的申請通過

# CP 專案

由洲哥負責的 CP 專案在本月即將告一階段，因此我協助建置正式機。由於這網站要求的安全性較以往更高，所以我接著幫此網站建置為 HTTPs 來加密通訊。事實上，我個人認為網站只要有帳號管理就必須要有加密的通訊，因為 Internet 是可以光明正大看別人通訊的內容。例如在某個小購物網站買了東西，詐騙電話馬上打來還知道你的訂單內容。（更諷刺的是，我買之前還寫了信去建議該網站，該網站還回信說沒問題啦，然後詐騙就打來...）另外 Google 早已公告有加密的網站，搜尋權重會比較高！（Ref. [[1]](https://webmasters.googleblog.com/2015/12/indexing-https-pages-by-default.html)[[2]](https://webmasters.googleblog.com/2014/08/https-as-ranking-signal.html)）

不過 HTTPs 需要申請公認且有效的憑證（要錢且有期限），需要的原因與詳細的原理屬於密碼學裡面的公開金鑰基礎設施（PKI），下略數萬字... 剛好有這機會讓我去跑一次憑證申請也挺新鮮有趣的，也還好以前我密碼學相關資料 K 了不少。申請還算順利，只是過程挺繁複就是了。

是說，為了讓 HTTPs 能夠普及化，大廠們成立了 [Let's Encrypt](https://letsencrypt.org/) 組織來提供免費且自動化的憑證申請與認證系統。由於這（美好？）的東西還在測試階段，因此我沒有用在此次的商用網站上（況且也不是按幾個按鈕就能使用它）。倒是公司內部使用的 Docker image/register 主機有使用 Let's Encrypt 的憑證，目前正常的運行當中。希望它正式推出後，我可以推行至公司往後的每一個網站上。

## 完成的項目

* BC #4 建置正式機
    + 放置在 S4
* F #16 申請與設定 SSL 憑證於正式機
    + 使用 PositiveSSL Certificate
    + 產生 CSR 並送交廠商進行簽署
    + 安裝 SSL 憑證於正式機
    + 設定重導 http 至 https


# ERP 2.0

阿信在這個月裡也開始將重心回歸 ERP 2.0 的開發上。由於公司開始走向制度化，首當其衝就是帳款的管理。因此需要 ERP 2.0 先行開發這方面的功能，用來取代純人工的作業。不過由於公司各種業務的需求與歷史演進，使得帳款與客戶管理十分地複雜。所以我居中協助阿信與小佩來討論並釐清問題，尤其是資料的處理問題。經過兩次會議後有了結論與方法，讓阿信在 ERP 2.0 的開發有了進展（我可是畫了精美的圖例呢 XD）。然而過渡期當中的資料管理，依然是個很大的挑戰呢～阿信加油

# Alpha 產品

本月我也開始將重心放回 Alpha 產品的開發，但剩下我孤軍奮鬥了（公司產品開發的人力需求高於工程師的數量，不過南部工程師很難找...）。除了要繼續功能的收尾之外，首先得改善爬蟲的穩定度。目前使用的爬蟲底層架構是沿用 NADS 所採用的，當初是為了盡快開發完成。但運作時間久了才發現此架構（SlimerJs, Node.js,... etc.）問題重重且作者修正速度慢，而更重要的因素是我發覺**許多網站必須跑在真正的瀏覽器上**否則很難預測會遇到什麼狀況（畢竟大家開發網站只支援主流瀏覽器！），因此改架構是勢在必行。

最終我挑選了老牌的自動化測試框架 Selenium 來建構，成熟、用戶多且開發者也多，更重要的是它**「使用真正的瀏覽器」**。最初 NADS 沒有採用是因為建置此架構很龐大，但現在 Selenium 也開始擁抱 Docker，讓我省去複雜的環境建置。雖然爬蟲都需要重寫，不過每個網站的爬法都已經寫過了，只是需要轉換成 Selenium。希望一切順利，可以趕上月底的產品發表。

# 完成的項目

* 搬移正式機至 GCE
    + 備份並移除舊主機（Linode）
    + 正式機尚有狀況未排除（預計 worker 改寫後再進行排除）
* 改用 Github 版本管理服務

# 執行中的項目

* BC #347 Worker 重新改以 Selenium WebDriver 建置更穩定的網頁爬蟲
    + 已建置 Selenium 系統架構與開發環境
    + 同時將 Worker 改為叢集架構（多台 Selenium）
    + 已完成 G

# 其他

* `apiplus.tw` 網域過期
    + 各個開發專案使用的 docker image repo. 皆使用此網域
    + 暫時使用我個人的網域
* 協助排除 s1.flashaim.com 的網站異常狀況
    + 硬碟空間已滿所導致
        - Paypal 付款網站的 bug 導致產生大量的 log 資料（1xxGB)
            * 協助洲哥修正 PHP 程式
* 協助排除 s2.flashaim.com 的網站異常狀況
    + 檔案系統變成唯讀狀態(/dev/root ro)
        - quota 沒有超過
        - 硬碟沒有滿
    + 磁碟陣列發生存取失敗
        - 系統最終使磁碟陣列進入唯獨狀態
        - 請廠商接續處理磁碟陣列的錯誤
* 協助架設 FTP server
    + 提供大圖檔、大檔案共用空間
    + 以 Docker 虛擬環境隔離實體環境
    + 採用 sftp 協定全程加密
    
# 後記

這個月身體狀況真的很差，手扭傷、腰閃到、大熱天還感冒，真是禍不單行，饒了我吧...