---
layout: post
title: '工作紀實 2017年 10月'
date: 2017-10-31 14:30
comments: true
categories: 
---
# FSB 產品

FSB 依然是本月重點開發項目（大概還要蟬聯很久...），也同樣是環繞於一對一對話功能。本月最大的*架構*改變，就是將**未讀訊息**改用**後端程式**去計算。最初使用前端程式去計算，目的是為了減輕伺服器的負擔。然而 Web App 無論如何也跟 App 有完全一樣的能力，所以當初也沒有打算改為純前端導向。否則把所有訊息通通丟到前端，也能採用前端程式計算未讀。但要這樣開發肯定還要花很久的時間（遠望），所以折衷還是改用後端計算了。這樣一來就不會再出現無法確定未讀數量的 ***N***了。

然而，當初使用 MS 系統來開發 FSB 其實並不合用，因為沒有考慮到「訊息依序處理」。這在一般網站不是必要條件，當然不會有這樣的設計。但是在 chat bot 的情境下，訊息是不斷餵進來 FSB 系統內的，不會管你前一個訊息處理多久。所以會發生「後一個訊息開始處理時，前一個訊息的處理還沒結束，但是兩個訊息有相依性必須照順序」的窘境。因此，有很多光怪陸離的現象（錯誤）就會被引發，而且很難人工重現。除非徹頭徹尾的更改訊息處理架構，改為 **Message Queueing** 架構，但這功夫就非常可觀了。只好先「頭痛醫頭、腳痛醫腳」，等待有時間研發 *BotCenter* 的那天惹（眺望）～～

## 完成項目

* #901 一對一對話聊天室的大頭照可以點擊放大 
* #902 新增聊天室過濾功能
* #904 直接於後端計算未讀訊息之數量 
* #917 進入一對一對話頁面不再預先載入第一個聊天室 
* #963 進入一對一聊天室會出現重複的對話記錄
* #964 一對一對話內的已讀資訊要重新整理後才出現
* #985 顯示一對一對話未讀訊息的總數 

## Review 項目

* #838 使用者傳圖需開啟一對一

# MS 產品

這個月發生了神秘現象，就是資料庫備份檔無論如何就是會備份失敗（暈）！但是網站備份就非常正常，手動下載也是正常！上網調查也找不出所以然，倒是找到治標的方法，設定讓 rsync 斷線重連（暈）。但最終我還是從 rsync 的 issue tracker 裡面，找到了一個**古老**而且**已經修正**的 issue：提到使用傳輸壓縮可能會斷線（Are you fxxking kidding me?!）。雖然我是使用 rsnapshot 但底層也是 rsync ，就死馬當活馬醫囉，取消傳輸壓縮～～～然後....然後死馬就復活了（靠北邊走啦，說好的已修正勒？！）

然後現在才發生則是因為，這個月資料庫大小剛好跨過 1GB ... ...

* 調查與修復每日資料庫備份失敗問題
    + Rsync 的 bug
        - 啟用傳輸壓縮會在單檔大過 1GB 時傳輸失敗 

# EB 案件

擠出一點時間，將授權流程做個修改。讓使用者授權後，自動關閉網頁回到 App。

* #9 更改授權流程

# 其他

* 協助建置OS電商網站測試機
* 協助建置金融行業系統開發與測試環境
    + 由於特殊需求所以花的時間特別久

# 後記

經常凌晨停機更新，加上之前常熬夜。身體越來越差呢～所以趕緊把補休特休都休一休，但我想，年底前都休不完吧（倒）。
